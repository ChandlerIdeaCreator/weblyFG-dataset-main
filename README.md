
# Peer-Learning Pro: ä¸€ä¸ªç”¨äºŽç½‘ç»œç›‘ç£ç»†ç²’åº¦å›¾åƒè¯†åˆ«çš„ä¼˜åŒ–æ¡†æž¶

[![Conference](https://img.shields.io/badge/åŸºäºŽ-ICCV%202021-blue)](https://arxiv.org/abs/2108.02399)
[![Framework](https://img.shields.io/badge/æ¡†æž¶-PyTorch-orange)](https://pytorch.org/)
[![License](https://img.shields.io/badge/è®¸å¯è¯-MIT-green)](LICENSE)

æœ¬é¡¹ç›®æ˜¯ICCV 2021è®ºæ–‡ **"Webly Supervised Fine--Grained Recognition: Benchmark Datasets and An Approach"** ä¸­æå‡ºçš„ **Peer-learning (å¯¹ç­‰å­¦ä¹ )** ç®—æ³•çš„ä¸€ä¸ªä¼˜åŒ–å’ŒçŽ°ä»£åŒ–å®žçŽ°ã€‚

æˆ‘ä»¬å°†å…¶å‘½åä¸º **Peer-learning Pro**ï¼Œå®ƒä¸“ä¸ºåº”å¯¹çŽ°ä»£æ·±åº¦å­¦ä¹ æŒ‘æˆ˜è€Œè®¾è®¡ï¼Œç›®æ ‡æ˜¯åœ¨å……æ»¡å™ªå£°ã€é•¿å°¾åˆ†å¸ƒçš„ç»†ç²’åº¦æ•°æ®é›†ä¸Šå®žçŽ°é¡¶å°–çš„æ€§èƒ½å’Œé«˜æ•ˆçš„è®­ç»ƒã€‚æ­¤æ¡†æž¶é›†æˆäº†ä¸€ç³»åˆ—å…ˆè¿›æŠ€æœ¯ï¼ŒåŒ…æ‹¬ **Swin Transformer**ã€**ConvNeXt** ç­‰çŽ°ä»£éª¨å¹²ç½‘ç»œï¼Œ**Balanced Softmax (å¹³è¡¡Softmax)** æŸå¤±å‡½æ•°ï¼Œä»¥åŠä¸“ä¸ºé«˜ç«¯GPUè®¾è®¡çš„å…¨å¥—æ€§èƒ½ä¼˜åŒ–ç­–ç•¥ã€‚

## ä¸»è¦ç‰¹æ€§ä¸Žå¢žå¼º

æœ¬å®žçŽ°è¿œè¶…åŽŸå§‹è®ºæ–‡çš„èŒƒç•´ï¼Œæä¾›äº†ä¸€ä¸ªåŠŸèƒ½å¼ºå¤§ä¸”é«˜åº¦çµæ´»çš„è®­ç»ƒæ¡†æž¶ï¼š

ðŸš€ **çŽ°ä»£åŒ–çš„ç½‘ç»œæž¶æž„ & éžå¯¹ç§°ååŒè®­ç»ƒ:**
- **å³æ’å³ç”¨çš„éª¨å¹²ç½‘ç»œ:** å€ŸåŠ©å¼ºå¤§çš„ `timm` åº“ï¼Œå¯è½»æ¾åœ¨ç»å…¸æ¨¡åž‹ (ResNet, VGG) å’ŒçŽ°ä»£æž¶æž„ (å¦‚ **ConvNeXt**, **Swin Transformer**) ä¹‹é—´åˆ‡æ¢ã€‚
- **éžå¯¹ç§°å¯¹ç­‰å­¦ä¹ :** åŽŸç”Ÿæ”¯æŒä½¿ç”¨ä¸¤ç§**ä¸åŒ**çš„æ¨¡åž‹æž¶æž„è¿›è¡ŒååŒè®­ç»ƒï¼ˆä¾‹å¦‚ï¼Œä¸€ä¸ªConvNeXtæ­é…ä¸€ä¸ªSwin Transformerï¼‰ï¼Œè¿™å¯ä»¥å¢žå¼ºæ¨¡åž‹çš„å¤šæ ·æ€§ï¼Œæ˜¾è‘—æå‡äº’ç›¸çº é”™çš„èƒ½åŠ›ã€‚

ðŸŽ¯ **é’ˆå¯¹æ ¸å¿ƒæŒ‘æˆ˜çš„å…ˆè¿›æŸå¤±å‡½æ•°:**
- **é›†æˆBalanced Softmax:** é€šè¿‡åœ¨å¯¹ç­‰å­¦ä¹ çš„â€œå…±è¯†é›†â€ä¸Šåº”ç”¨Balanced SoftmaxæŸå¤±ï¼Œç²¾å‡†åœ°è§£å†³äº†**ç±»åˆ«ä¸å‡è¡¡**é—®é¢˜ï¼Œæžå¤§æå‡äº†åœ¨é•¿å°¾æ•°æ®é›†ä¸Šçš„è¡¨çŽ°ã€‚
- **æ ‡ç­¾å¹³æ»‘ (Label Smoothing):** åœ¨æ‰€æœ‰äº¤å‰ç†µæŸå¤±è®¡ç®—ä¸­åº”ç”¨æ ‡ç­¾å¹³æ»‘ï¼Œä»¥æé«˜æ¨¡åž‹çš„æ³›åŒ–èƒ½åŠ›å’Œå¯¹æ ‡ç­¾å™ªå£°çš„é²æ£’æ€§ã€‚

âš¡ **é¡¶çº§çš„è®­ç»ƒæ•ˆçŽ‡ä¸Žæ€§èƒ½ä¼˜åŒ–:**
- **è‡ªåŠ¨æ··åˆç²¾åº¦è®­ç»ƒ (AMP):** å…¨é¢æ”¯æŒ `bfloat16` å’Œ `float16` æ ¼å¼ï¼Œèƒ½å¤Ÿåœ¨çŽ°ä»£NVIDIA GPUï¼ˆå¦‚å®‰åŸ¹/Adaæž¶æž„çš„RTX 30/40ç³»åˆ—ï¼‰ä¸Š**æ˜¾è‘—åŠ é€Ÿè®­ç»ƒ**å¹¶**é™ä½Žæ˜¾å­˜å ç”¨**ã€‚
- **AdamW ä¼˜åŒ–å™¨:** ä½¿ç”¨AdamWä»¥èŽ·å¾—æ›´å¥½çš„æƒé‡è¡°å‡å’Œæ­£åˆ™åŒ–æ•ˆæžœã€‚
- **é«˜çº§å­¦ä¹ çŽ‡ç­–ç•¥:**
    - **ä½™å¼¦é€€ç«ä¸Žé¢„çƒ­ (Cosine Annealing with Warmup):** çŽ°ä»£è®­ç»ƒæµç¨‹çš„æ ‡é…ã€‚
    - **åˆ†å±‚å­¦ä¹ çŽ‡è¡°å‡ (LLRD):** å¯¹Swin Transformerå’ŒConvNeXtç­‰æž¶æž„è‡ªåŠ¨å¯ç”¨ï¼Œä»¥å®žçŽ°æœ€ä½³å¾®è°ƒæ•ˆæžœã€‚
    - **åˆ¤åˆ«å¼å­¦ä¹ çŽ‡:** å¯¹å…¶ä»–æž¶æž„ï¼Œä¸ºéª¨å¹²ç½‘ç»œå’Œåˆ†ç±»å¤´è®¾ç½®ä¸åŒçš„å­¦ä¹ çŽ‡ã€‚
- **æ¸è¿›å¼å°ºå¯¸è°ƒæ•´ (Progressive Resizing):** è®­ç»ƒå‰æœŸä½¿ç”¨è¾ƒå°åˆ†è¾¨çŽ‡ä»¥åŠ é€Ÿæ”¶æ•›ï¼ŒåŽæœŸåˆ‡æ¢åˆ°æ›´å¤§åˆ†è¾¨çŽ‡è¿›è¡Œç²¾è°ƒï¼Œå…¼é¡¾é€Ÿåº¦ä¸Žç²¾åº¦ã€‚
- **å¼ºå¤§çš„æ•°æ®å¢žå¼º:** é›†æˆäº†`TrivialAugmentWide`å’Œ`RandomErasing`ç­‰å¼ºåŠ›æ­£åˆ™åŒ–æ‰‹æ®µï¼Œæœ‰æ•ˆå¯¹æŠ—è¿‡æ‹Ÿåˆã€‚
- **æŒ‡æ•°ç§»åŠ¨å¹³å‡ (EMA):** ç»´æŠ¤æ¨¡åž‹æƒé‡çš„EMAå‰¯æœ¬ï¼Œç”¨äºŽæœ€ç»ˆè¯„ä¼°ï¼Œé€šå¸¸èƒ½å¸¦æ¥æ›´ç¨³å®šå’Œæ›´é«˜çš„æ€§èƒ½ã€‚

## æ ¸å¿ƒç®—æ³•: Peer-learning Pro

æœ¬æ¡†æž¶çš„æ ¸å¿ƒæ€æƒ³å¿ äºŽåŽŸå§‹è®ºæ–‡ï¼Œå¹¶è¿›è¡Œäº†å…³é”®å¢žå¼ºï¼š

1.  **å¹¶è¡Œè®­ç»ƒ:** ä¸¤ä¸ªç‹¬ç«‹çš„ç½‘ç»œ (`net1` å’Œ `net2`) è¢«åŒæ—¶è®­ç»ƒã€‚
2.  **åŠ¨æ€æ•°æ®åˆ’åˆ†:** åœ¨æ¯ä¸ªæ‰¹æ¬¡ä¸­ï¼Œæ ·æœ¬æ ¹æ®ä¸¤ä¸ªç½‘ç»œçš„é¢„æµ‹ç»“æžœè¢«åˆ’åˆ†ä¸ºï¼š
    *   **å…±è¯†é›† (Agreement Set, Gs):** ä¸¤ä¸ªç½‘ç»œé¢„æµ‹**ç›¸åŒ**çš„æ ·æœ¬ã€‚è¿™äº›è¢«è®¤ä¸ºæ˜¯â€œç®€å•â€æˆ–å¤§æ¦‚çŽ‡å¹²å‡€çš„æ ·æœ¬ã€‚
    *   **åˆ†æ­§é›† (Disagreement Set, Gd):** ä¸¤ä¸ªç½‘ç»œé¢„æµ‹**ä¸åŒ**çš„æ ·æœ¬ã€‚è¿™äº›è¢«è®¤ä¸ºæ˜¯â€œå›°éš¾â€æˆ–å¯èƒ½å¸¦å™ªçš„æ ·æœ¬ã€‚
3.  **äº¤å‰ç›‘ç£ä¸Žç²¾ç‚¼:**
    *   **å¯¹äºŽå…±è¯†é›†:** æ¯ä¸ªç½‘ç»œè®¡ç®—å‡ºå„è‡ªçš„æ ·æœ¬æŸå¤±ã€‚**ï¼ˆå¢žå¼ºç‚¹ï¼‰** æ­¤å¤„æˆ‘ä»¬ä½¿ç”¨ **Balanced Softmax Loss**ï¼Œä½¿å¾—æŸå¤±çš„è®¡ç®—å¯¹å°‘æ•°ç±»æ›´æ•æ„Ÿã€‚ç„¶åŽï¼Œæ¯ä¸ªç½‘ç»œæŒ‘é€‰å‡ºå¯¹æ–¹è®¤ä¸º**æŸå¤±æœ€å°**ï¼ˆæœ€ç®€å•ï¼‰çš„ä¸€éƒ¨åˆ†æ ·æœ¬è¿›è¡Œå­¦ä¹ ã€‚è¿™èƒ½æœ‰æ•ˆé˜²æ­¢ä¸¤ä¸ªæ¨¡åž‹äº’ç›¸å¼ºåŒ–å¯¹å™ªå£°çš„é”™è¯¯è®°å¿†ã€‚
    *   **å¯¹äºŽåˆ†æ­§é›†:** ä¸¤ä¸ªç½‘ç»œéƒ½å­¦ä¹ å…¨éƒ¨åˆ†æ­§æ ·æœ¬ï¼Œè¿«ä½¿å®ƒä»¬ä»Žå›°éš¾æ¡ˆä¾‹ä¸­å¯»æ‰¾æ­£ç¡®çš„åˆ†ç±»è¾¹ç•Œã€‚

## å¿«é€Ÿå¼€å§‹

### 1. çŽ¯å¢ƒé…ç½®

- Python 3.8+
- PyTorch 2.0+ (**å¿…é¡»æ˜¯æ”¯æŒCUDAçš„GPUç‰ˆæœ¬**)
- NVIDIA GPU (æŽ¨èä½¿ç”¨å®‰åŸ¹æž¶æž„æˆ–æ›´æ–°çš„æ˜¾å¡ï¼Œå¦‚RTX 30/40ç³»åˆ—)
- `timm` åº“: å¦‚æžœæœªå®‰è£…ï¼Œå¯åŠ¨è„šæœ¬ä¼šè‡ªåŠ¨å°è¯•å®‰è£…ã€‚

```bash
# å…‹éš†æœ¬ä»“åº“
git clone https://github.com/your-username/your-repo-name.git
cd your-repo-name

# åˆ›å»ºå¹¶æ¿€æ´»condaè™šæ‹ŸçŽ¯å¢ƒ (æŽ¨è)
conda create -n peer_learning python=3.10
conda activate peer_learning

# å®‰è£…PyTorch (è¯·ä»Žå®˜ç½‘èŽ·å–ä¸Žæ‚¨æ˜¾å¡é©±åŠ¨åŒ¹é…çš„å‘½ä»¤)
# è®¿é—®: https://pytorch.org/get-started/locally/
# ä¾‹å¦‚ï¼Œé’ˆå¯¹CUDA 12.1:
# conda install pytorch torchvision torchaudio pytorch-cuda=12.1 -c pytorch -c nvidia

# å®‰è£…å…¶ä»–ä¾èµ–
pip install timm tqdm scikit-learn
```

### 2. æ•°æ®å‡†å¤‡

æœ¬é¡¹ç›®å‡è®¾ç«žèµ›åœºæ™¯ä»…æä¾›è®­ç»ƒé›†ï¼Œæ‚¨éœ€è¦æ‰‹åŠ¨å°†å…¶åˆ’åˆ†ä¸ºè®­ç»ƒ/éªŒè¯é›†ã€‚

#### æ•°æ®é›†ä¸‹è½½

- **è®­ç»ƒæ•°æ®:**
  - **ç™¾åº¦ç½‘ç›˜:** [https://pan.baidu.com/s/1oYA7nThCwe38fS6dvMtsnA](https://pan.baidu.com/s/1oYA7nThCwe38fS6dvMtsnA) (æå–ç : `g8pj`)
  - **å¤¸å…‹ç½‘ç›˜:** [https://pan.quark.cn/s/efa3db093bee](https://pan.quark.cn/s/efa3db093bee) (æå–ç : `REbs`)

- **æµ‹è¯•æ•°æ®:**
  - **ç™¾åº¦ç½‘ç›˜:** [https://pan.baidu.com/s/1dXMHRciDf4v-f-qzF5MF-g](https://pan.baidu.com/s/1dXMHRciDf4v-f-qzF5MF-g) (æå–ç : `ev3m`)

#### æ•°æ®åˆ’åˆ†æ­¥éª¤

1.  **ç»„ç»‡æ•°æ®:** ä¸‹è½½è®­ç»ƒæ•°æ®åŽï¼Œè§£åŽ‹å¹¶ç»„ç»‡æˆå¦‚ä¸‹çš„ImageFolderç»“æž„ï¼Œå­˜æ”¾åœ¨ä¸€ä¸ªæ ¹ç›®å½•ï¼ˆä¾‹å¦‚`competition_data`ï¼‰ä¸‹ï¼š
    ```
    competition_data/
    â””â”€â”€ train/
        â”œâ”€â”€ 000/
        â”‚   â”œâ”€â”€ image_01.jpg
        â”‚   â””â”€â”€ ...
        â”œâ”€â”€ 001/
        â””â”€â”€ ...
    ```

2.  **è¿è¡Œåˆ’åˆ†è„šæœ¬:**
    æˆ‘ä»¬ä½¿ç”¨`split_dataset_final.py`è„šæœ¬æ¥åˆ’åˆ†æ•°æ®ã€‚ä¸ºèŠ‚çœç£ç›˜ç©ºé—´å¹¶å…¼å®¹æœåŠ¡å™¨éƒ¨ç½²ï¼ŒæŽ¨èä½¿ç”¨ **'move' (ç§»åŠ¨/å‰ªåˆ‡)** æ¨¡å¼ã€‚
    **é‡è¦æç¤º: 'move'æ¨¡å¼ä¼šæ¸…ç©ºåŽŸå§‹çš„`train`æ–‡ä»¶å¤¹ï¼Œè¯·åŠ¡å¿…æå‰å¤‡ä»½ï¼**

    *   **é…ç½®è„šæœ¬:** æ‰“å¼€`split_dataset_final.py`ï¼Œåœ¨æ–‡ä»¶æœ«å°¾çš„é…ç½®åŒºä¿®æ”¹`COMPETITION_DATA_ROOT`ä¸ºä½ è‡ªå·±çš„æ•°æ®æ ¹ç›®å½•ï¼Œå¹¶ç¡®è®¤`MODE = 'move'`ã€‚
    *   **è¿è¡Œåˆ’åˆ†:**
        ```bash
        python split_dataset_final.py
        ```
        æ ¹æ®æç¤ºè¾“å…¥`yes`ç¡®è®¤ã€‚è„šæœ¬å°†ç”Ÿæˆ`train_split_move`å’Œ`val_split_move`ä¸¤ä¸ªæ–‡ä»¶å¤¹ã€‚

3.  **é‡å‘½åæ–‡ä»¶å¤¹:**
    ä¸ºäº†ä¸Žè®­ç»ƒè„šæœ¬å…¼å®¹ï¼Œè¯·å°†ç”Ÿæˆçš„æ–‡ä»¶å¤¹é‡å‘½åï¼š
    *   `train_split_move` -> `train_split`
    *   `val_split_move` -> `val_split`

### 3. æ¨¡åž‹è®­ç»ƒ

è®­ç»ƒè¿‡ç¨‹ç”±é«˜åº¦å¯é…ç½®çš„`run_training.sh`è„šæœ¬æŽ§åˆ¶ã€‚

1.  **é…ç½® `run_training.sh`:**
    æ‰“å¼€è„šæœ¬ï¼Œä¿®æ”¹æ–‡ä»¶å¼€å¤´çš„**â€œä½¿ç”¨é…ç½®åŒºâ€**ï¼š
    *   `CUDA_VISIBLE_DEVICES`: è®¾ç½®æ‚¨è¦ä½¿ç”¨çš„GPU IDã€‚
    *   `DATA_PATH`: è®¾ç½®ä¸ºæ‚¨çš„æ•°æ®é›†æ ¹ç›®å½• (ä¾‹å¦‚, `"competition_data"`)ã€‚
    *   `NUM_CLASSES`: è®¾ç½®æ‚¨æ•°æ®é›†çš„å‡†ç¡®ç±»åˆ«æ€»æ•°ã€‚
    *   `NET1_ARCH` & `NET2_ARCH`: é€‰æ‹©æ‚¨æƒ³ä½¿ç”¨çš„æ¨¡åž‹æž¶æž„ç»„åˆã€‚
    *   æ ¹æ®æ‚¨çš„ç¡¬ä»¶æƒ…å†µè°ƒæ•´`BATCH_SIZE`ã€`EPOCHS`å’Œå­¦ä¹ çŽ‡`BASE_LR`ã€‚

2.  **å¼€å§‹è®­ç»ƒ:**
    é¦–å…ˆç»™è„šæœ¬æ‰§è¡Œæƒé™ï¼Œç„¶åŽè¿è¡Œå®ƒï¼š
    ```bash
    chmod +x run_training.sh
    ./run_training.sh
    ```

è„šæœ¬å°†è‡ªåŠ¨æ‰§è¡Œå®Œæ•´çš„ä¸¤é˜¶æ®µè®­ç»ƒæµç¨‹ï¼Œå¹¶å°†æ¯ä¸ªé˜¶æ®µçš„æœ€ä½³æ¨¡åž‹æƒé‡ä¿å­˜åœ¨`model/`ç›®å½•ä¸‹ã€‚

## ReferenceReference




> Zeren Sun, Yazhou Yao, Xiu-Shen Wei, Yongshun Zhang, Fumin Shen, Jianxin Wu, Jian Zhang, and Heng Tao Shen. **"Webly Supervised Fine-Grained Recognition: Benchmark Datasets and An Approach"**. In *Proceedings of the IEEE/CVF International Conference on Computer Vision (ICCV)*, 2021.



